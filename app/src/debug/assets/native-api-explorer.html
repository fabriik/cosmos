<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body bgcolor="#FFFFFF">
<form>
    <fieldset>
        <p>
            <label for="toAddress">To Address</label>
            <input id="toAddress" type="text" value="1ALcVQ2ip7Pkx8bwh8vwUvQy8JdzEE6t49"/>
        </p>
        <p>
            <label for="currencyCode">Currency Code</label>
            <input id="currencyCode" type="text" value="btc"/>
        </p>
        <p>
            <label for="amount">Amount</label>
            <input id="amount" type="text" value="1"/>
        </p>
        <p>
            <button onclick="submitTransaction(); return false;">Submit</button>
        </p>
        <p>
            <span id="txOutput"></span>
        </p>
    </fieldset>
    <fieldset>
        <p>
            <label for="enableWalletCurrencyCode">Currency Code</label>
            <input id="enableWalletCurrencyCode" type="text" value="eth"/>
        </p>
        <p>
            <button onclick="enableWallet(); return false;">Enable wallet</button>
        </p>
        <p>
            <span id="enableWalletOutput"></span>
        </p>
    </fieldset>
    <fieldset>
        <p>
            <label for="listAll">List all</label>
            <input checked checked id="listAll" type="checkbox"/>
        </p>
        <p>
            <button onclick="listCurrencies(); return false;">Get currencies</button>
        </p>
        <p>
            <span id="currenciesOutput"></span>
        </p>
    </fieldset>
    <fieldset>
        <p>
            <label for="maxlimitToAddress">To Address</label>
            <input id="maxlimitToAddress" type="text" value="1ALcVQ2ip7Pkx8bwh8vwUvQy8JdzEE6t49"/>
        </p>
        <p>
            <label for="maxlimitCurrencyCode">Currency Code</label>
            <input id="maxlimitCurrencyCode" type="text" value="btc"/>
        </p>
        <p>
            <button onclick="maxlimit(); return false;">Get maxlimit</button>
        </p>
        <p>
            <span id="maxlimitOutput"></span>
        </p>
    </fieldset>
</form>

<script type="application/javascript">
    function injectPromiseHooks() {
        let nativeObjs = JSON.parse(NativeApisJs.getApiNamesJson())
        nativeObjs.forEach( nativeObjectName => {
            let objectName = nativeObjectName.replace("_Native", "")
            window[objectName] = Object()
            for (let [key, value] of Object.entries(window[nativeObjectName])) {
                window[objectName][key] = function() {
                    let primaryArgs = arguments
                    return new Promise(function(resolve, reject) {
                        let promiseBinder = value.apply(window[nativeObjectName], primaryArgs)
                        let callbackName = promiseBinder.getJsName()
                        if (typeof window.brdCallbacks === 'undefined') {
                            window.brdCallbacks = Object()
                        }
                        window.brdCallbacks[callbackName] = {
                            scope: this,
                            resolve: resolve,
                            reject: reject
                        }
                        promiseBinder.execute()
                    })
                }
            }
        })
    }

    injectPromiseHooks()

    function submitTransaction() {
        let txOutput = document.getElementById("txOutput");
        txOutput.innerText = "";

        let toAddress = document.getElementById("toAddress").value;
        let currencyCode = document.getElementById("currencyCode").value;
        let amount = document.getElementById("amount").value;
        let amountStr = JSON.stringify({ "numerator" : amount, "denominator": "1" });

        WalletJs.transaction(toAddress, "", amountStr, currencyCode)
            .then((transaction) => {
                txOutput.innerText = `Hash: ${transaction.hash}\n Transmitted: ${transaction.transmitted}`;
            })
            .catch((error) => {
                txOutput.innerText = error;
            })

    }

    function enableWallet() {
        let enableWalletOutput = document.getElementById("enableWalletOutput");
        let currencyCode = document.getElementById("enableWalletCurrencyCode").value;
        WalletJs.enableCurrency(currencyCode)
            .then((result) => {
                enableWalletOutput.innerText = `Wallet added ${result.currency}`;
            })
            .catch((error) => {
                enableWalletOutput.innerText = error;
            })
    }

    function listCurrencies() {
        let currenciesOutput = document.getElementById("currenciesOutput");
        let listAll = document.getElementById("listAll").checked;

        WalletJs.currencies(listAll)
            .then((result) => {
                currenciesOutput.innerText = `${result.currencies.length} currencies retrieved`;
            })
            .catch((error) => {
                currenciesOutput.innerText = error;
            })
    }

    function maxlimit() {
        let maxlimitOutput = document.getElementById("maxlimitOutput");
        maxlimitOutput.innerText = "";

        let toAddress = document.getElementById("maxlimitToAddress").value;
        let currencyCode = document.getElementById("maxlimitCurrencyCode").value;

        WalletJs.maxlimit(toAddress, currencyCode)
            .then((limit) => {
                let num = parseFloat(limit.numerator)
                let den = parseFloat(limit.denominator)
                let maxlimit = num/den

                maxlimitOutput.innerText = `maxlimit: ${maxlimit}\n`;
            })
            .catch((error) => {
                maxlimitOutput.innerText = error;
            })
    }



</script>
</body>
</html>
